{"version":3,"sources":["../../src/js/plugin.js"],"names":["$","jQuery","ApiValidator","_fields","fields","setEvents","self","i","length","field","on","event","preventDefault","validateFields","parent","find","remove","fieldsNotEmpty","checkApi","removeClass","session","createSession","isValidPromise","hasValidCredentials","then","_parent","isValid","addClass","validateFalse","e","error","_error","TalkJS","errors","noValidKey","last","append","fullLength","toArray","filter","val","appId","secretKey","user","Talk","User","id","userSettings","uid","name","Session","me","signature","CryptoJS","HmacSHA256","toString","enc","Hex","UserRoleValidator","apiConnection","first","siblings","is","validateRole","hasConfiguration","_value","configurationNotAvailable","_validated","hasClass","configurationsNotSet","SettingsPage","apiValidator","userRoleValidator","setTimeout","submit","ready"],"mappings":";;;;;;AACI,IAAMA,IAAIC,MAAV;;AAEH;;IACMC,Y;AAEL,kCAAaC,OAAb,EAAsB;AAAA;;AAEZ,6BAAKC,MAAL,GAAcD,OAAd;AACA,6BAAKE,SAAL;AAET;;AAED;;;;;;;oDAGW;;AAEV,wCAAIC,OAAO,IAAX;;AAEA,yCAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,KAAKF,MAAL,CAAYI,MAAhC,EAAwCD,GAAxC,EAA6C;;AAE5C,oDAAIE,QAAQT,EAAG,KAAKI,MAAL,CAAaG,CAAb,CAAH,CAAZ;AACAE,sDAAMC,EAAN,CAAU,QAAV,EAAoB,iBAAS;;AAE5BC,kEAAMC,cAAN;AACAN,iEAAKO,cAAL,CAAqBP,IAArB;AAEA,iDALD;AAOA;;AAEDA,yCAAKO,cAAL,CAAqBP,IAArB;AACA;;AAID;;;;;;;;;;uDAOgBA,I,EAAM;;AAEZA,yCAAKF,MAAL,CAAYU,MAAZ,GAAqBC,IAArB,CAA0B,oBAA1B,EAAgDC,MAAhD;;AAEA,wCAAIV,KAAKW,cAAL,CAAqBX,IAArB,CAAJ,EAAiC;;AAE7BA,qDAAKY,QAAL,CAAeZ,IAAf;AAEH,qCAJD,MAIK;AACDA,qDAAKF,MAAL,CAAYU,MAAZ,GAAqBK,WAArB,CAAkC,WAAlC;AACAb,qDAAKF,MAAL,CAAYU,MAAZ,GAAqBK,WAArB,CAAkC,iBAAlC;AACH;AACV;;AAED;;;;;;;;;;iDAOUb,I,EAAM;;AAEN,wCAAIc,UAAUd,KAAKe,aAAL,CAAoBf,IAApB,CAAd;AACA,wCAAIgB,iBAAiBF,QAAQG,mBAAR,EAArB;;AAEA,wCAAG;;AAEXD,+DAAeE,IAAf,CAAqB,mBAAW;;AAEhB,gEAAIC,UAAUnB,KAAKF,MAAL,CAAYU,MAAZ,EAAd;;AAEA,gEAAIY,OAAJ,EAAa;AACTD,gFAAQE,QAAR,CAAkB,WAAlB;AACAF,gFAAQN,WAAR,CAAqB,iBAArB;AACAM,gFAAQE,QAAR,CAAkB,gBAAlB;AAClB,6DAJc,MAIV;AACcrB,6EAAKsB,aAAL,CAAoBtB,IAApB;AACH;AAChB,iDAXD;AAaA,qCAfQ,CAeP,OAAOuB,CAAP,EAAU;AACCvB,qDAAKsB,aAAL,CAAoBtB,IAApB;AACZ;AACK;;AAED;;;;;;;;sDAKeA,I,EAAMwB,K,EAAO;;AAExB,wCAAIL,UAAUnB,KAAKF,MAAL,CAAYU,MAAZ,EAAd;AACA,wCAAIiB,SAASD,KAAb;;AAEA,wCAAI,OAAQA,KAAR,IAAmB,WAAvB,EAAoC;AAChCA,wDAAQE,OAAOC,MAAP,CAAcC,UAAtB;AACZ;;AAEQT,4CAAQE,QAAR,CAAkB,WAAlB;AACAF,4CAAQN,WAAR,CAAqB,gBAArB;AACAM,4CAAQE,QAAR,CAAkB,iBAAlB;AACArB,yCAAKF,MAAL,CAAY+B,IAAZ,GAAmBrB,MAAnB,GAA4BsB,MAA5B,CAAmC,oCAAkCN,KAAlC,GAAwC,QAA3E;AAEH;;AAEP;;;;;;;;;;uDAOgBxB,I,EAAM;;AAErB,wCAAI+B,aAAa/B,KAAKF,MAAL,CAAYI,MAA7B;;AAEA;AACA,wCAAIJ,SAASE,KAAKF,MAAL,CAAYkC,OAAZ,EAAb;AACAlC,6CAASA,OAAOmC,MAAP,CAAe;AAAA,uDAASvC,EAAGS,KAAH,EAAW+B,GAAX,MAAoB,EAA7B;AAAA,qCAAf,CAAT;;AAEA;AACA,wCAAIpC,OAAOI,MAAP,IAAiB6B,UAArB,EACC,OAAO,IAAP;;AAED,2CAAO,KAAP;AACM;;;sDAGc/B,I,EAAM;;AAEjB,wCAAMmC,QAAQzC,EAAE,mBAAF,EAAuBwC,GAAvB,EAAd;AACA,wCAAME,YAAY1C,EAAE,uBAAF,EAA2BwC,GAA3B,EAAlB;;AAEA,wCAAIG,OAAO,IAAIC,KAAKC,IAAT,CAAc,EAAEC,IAAIC,aAAaC,GAAnB,EAAwBC,MAAM,MAA9B,EAAd,CAAX;AACA,wCAAI7B,UAAU,IAAIwB,KAAKM,OAAT,CAAiB;AAC3BT,uDAAOA,KADoB;AAE3BU,oDAAIR,IAFuB;AAG3BS,2DAAWC,SAASC,UAAT,CAAoBX,KAAKG,EAAzB,EAA6BJ,SAA7B,EAAwCa,QAAxC,CAAiDF,SAASG,GAAT,CAAaC,GAA9D;AAHgB,qCAAjB,CAAd;;AAMA,2CAAOrC,OAAP;AACH;;;;;;AAIL;;;IACMsC,iB;AAEF,uCAAatD,MAAb,EAAqBuD,aAArB,EAAoC;AAAA;;AAChC,6BAAKvD,MAAL,GAAcA,MAAd;AACA,6BAAKU,MAAL,GAAcV,OAAOwD,KAAP,GAAe9C,MAAf,GAAwBA,MAAxB,EAAd;AACA,6BAAK6C,aAAL,GAAqBA,aAArB;;AAEA,6BAAKtD,SAAL;AACH;;AAED;;;;;;;oDAGK;AAAA;;AAEV,wCAAIC,OAAO,IAAX;;AAFU,+DAIDC,CAJC;;AAMG,oDAAIE,QAAQT,EAAG,MAAKI,MAAL,CAAaG,CAAb,CAAH,CAAZ;AACZE,sDAAMC,EAAN,CAAU,QAAV,EAAoB,iBAAS;;AAEbD,kEAAMU,WAAN,CAAmB,cAAnB;AACAV,kEAAMoD,QAAN,CAAe,eAAf,EAAgC7C,MAAhC;;AAEf,gEAAIP,MAAMqD,EAAN,CAAS,UAAT,CAAJ,EAA2B;AACRxD,6EAAKyD,YAAL,CAAmBzD,IAAnB,EAAyBG,KAAzB;AACH;;AAEDH,iEAAKO,cAAL,CAAqBP,IAArB;AACf,iDAVD;AAPS;;AAIV,yCAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,KAAKF,MAAL,CAAYI,MAAhC,EAAwCD,GAAxC,EAA6C;AAAA,sDAApCA,CAAoC;AAcnC;AAEV;;AAEK;;;;;;;;;qDAMcD,I,EAAMG,K,EAAO;;AAEvB,wCAAIW,UAAU,KAAKuC,aAAL,CAAmBtC,aAAnB,CAAkC,KAAKsC,aAAvC,CAAd;;AAEA,wCAAI,OAAQvC,QAAQ4C,gBAAhB,IAAsC,WAA1C,EACI,OAAO,IAAP;;AAGJ,wCAAG;;AAEC,oDAAIC,SAASxD,MAAM+B,GAAN,EAAb;AACZpB,wDAAQ4C,gBAAR,CAA0BC,MAA1B,EAAmCzC,IAAnC,CAAyC,mBAAW;;AAEpC,gEAAIC,UAAUnB,KAAKF,MAAL,CAAYU,MAAZ,EAAd;;AAEA,gEAAI,CAACY,OAAL,EAAc;;AAEVjB,8EAAMkB,QAAN,CAAgB,cAAhB;AACAlB,8EAAMK,MAAN,GAAesB,MAAf,CAAsB,+BAA6BJ,OAAOC,MAAP,CAAciC,yBAA3C,GAAqE,MAA3F;AAEH,6DALD,MAKK;AACD,+EAAO,IAAP;AACH;AAChB,iDAZD;AAcA,qCAjBQ,CAiBP,OAAOrC,CAAP,EAAU;AACC,uDAAO,IAAP;AACH;;AAED,2CAAO,KAAP;AACH;;AAED;;;;;;;;uDAKgBvB,I,EAAM;;AAElB,wCAAI6D,aAAa,IAAjB;;AAEA,yCAAK,IAAI5D,IAAI,CAAb,EAAgBA,IAAID,KAAKF,MAAL,CAAYI,MAAhC,EAAwCD,GAAxC,EAA6C;;AAEzC,oDAAIE,SAAQT,EAAG,KAAKI,MAAL,CAAaG,CAAb,CAAH,CAAZ;AACA,oDAAIE,OAAM2D,QAAN,CAAgB,cAAhB,CAAJ,EACID,aAAa,KAAb;AAEP;;AAED7D,yCAAKQ,MAAL,CAAYC,IAAZ,CAAiB,oBAAjB,EAAuCC,MAAvC;;AAEA,wCAAImD,cAAc,KAAlB,EAAyB;AACrB7D,qDAAKQ,MAAL,CAAYsB,MAAZ,CAAmB,oCAAkCJ,OAAOC,MAAP,CAAcoC,oBAAhD,GAAqE,QAAxF;AACH;AACJ;;;;;;AAIR;;;IACMC,Y;AAEL,oCAAa;AAAA;;AAEH,4BAAInE,UAAUH,EAAG,mBAAH,CAAd;AACA,4BAAIG,QAAQK,MAAR,GAAiB,CAArB,EAAyB;AACjC,yCAAK+D,YAAL,GAAoB,IAAIrE,YAAJ,CAAkBC,OAAlB,CAApB;AACA,yCAAKqE,iBAAL,GAAyB,IAAId,iBAAJ,CAAuB1D,EAAE,uBAAF,CAAvB,EAAmD,KAAKuE,YAAxD,CAAzB;AACY,yCAAKlE,SAAL;AACZ;AAED;;;;oDAGU;;AAEVL,sCAAE,iCAAF,EAAqCU,EAArC,CAAyC,WAAzC,EAAsD,iBAAS;AAClDC,sDAAMC,cAAN;;AAEA,oDAAIZ,EAAE,yCAAF,EAA6CQ,MAA7C,GAAsD,CAA1D,EAA6D;;AAEzDR,8DAAE,2CAAF,EAAgD2B,QAAhD,CAA0D,QAA1D;AACA8C,uEAAY,YAAM;AACdzE,0EAAE,2CAAF,EAA+CmB,WAA/C,CAA4D,QAA5D;AACH,6DAFD,EAEG,IAFH;AAIH,iDAPD,MAOK;AACDnB,8DAAE,6BAAF,EAAiC0E,MAAjC;AACH;AAGJ,qCAfV;AAiBA;;;;;;AAIF9B,KAAK+B,KAAL,CAAWnD,IAAX,CAAiB,YAAM;AACtB,gBAAI8C,YAAJ;AAEA,CAHD","file":"app.js","sourcesContent":["\r\n    const $ = jQuery;\r\n\r\n\t//validator\r\n\tclass ApiValidator{\r\n\r\n\t\tconstructor( _fields ){\r\n\r\n            this.fields = _fields;\r\n            this.setEvents();\r\n\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Set all events for this class\r\n\t\t */\r\n\t\tsetEvents(){\r\n\r\n\t\t\tlet self = this;\r\n\r\n\t\t\tfor( let i = 0; i < self.fields.length; i++ ){\r\n\r\n\t\t\t\tlet field = $( this.fields[ i ] );\r\n\t\t\t\tfield.on( 'change', event => {\r\n\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tself.validateFields( self );\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t}\r\n\r\n\t\t\tself.validateFields( self );\r\n\t\t}\r\n\r\n\r\n\r\n\t\t/**\r\n\t\t * Validate field function\r\n\t\t *\r\n\t\t * @param  ApiValidator self\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tvalidateFields( self ){\r\n\r\n            self.fields.parent().find('.validation-errors').remove();\r\n\r\n            if( self.fieldsNotEmpty( self ) ){\r\n\r\n                self.checkApi( self );\r\n\r\n            }else{\r\n                self.fields.parent().removeClass( 'validated' );\r\n                self.fields.parent().removeClass( 'validated-false' );\r\n            }\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Check the api\r\n\t\t *\r\n\t\t * @param  ApiValidator self\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tcheckApi( self ){\r\n\r\n            let session = self.createSession( self );\r\n            let isValidPromise = session.hasValidCredentials();\r\n\r\n            try{\r\n\r\n\t\t\t\tisValidPromise.then( isValid => {\r\n\r\n                    let _parent = self.fields.parent();\r\n\r\n                    if( isValid ){\r\n                        _parent.addClass( 'validated' );\r\n                        _parent.removeClass( 'validated-false' );\r\n                        _parent.addClass( 'validated-true' );\r\n\t\t\t\t\t}else{\r\n                        self.validateFalse( self );\r\n                    }\r\n\t\t\t\t});\r\n\r\n\t\t\t} catch( e ){\r\n                self.validateFalse( self );\r\n\t\t\t}\r\n        }\r\n\r\n        /**\r\n         * Validate this field as false\r\n         *\r\n         * @param Object self\r\n         */\r\n        validateFalse( self, error ){\r\n\r\n            let _parent = self.fields.parent();\r\n            let _error = error;\r\n\r\n            if( typeof( error ) == 'undefined' ){\r\n                error = TalkJS.errors.noValidKey;\r\n\t\t\t}\r\n\r\n            _parent.addClass( 'validated' );\r\n            _parent.removeClass( 'validated-true' );\r\n            _parent.addClass( 'validated-false' );\r\n            self.fields.last().parent().append('<div class=\"validation-errors\">'+error+'</div>');\r\n\r\n        }\r\n\r\n\t\t/**\r\n\t\t * Check to see if these fields aren't empty\r\n\t\t *\r\n\t\t * @param  ApiValidator self\r\n\t\t *\r\n\t\t * @return boolean\r\n\t\t */\r\n\t\tfieldsNotEmpty( self ){\r\n\r\n\t\t\tlet fullLength = self.fields.length;\r\n\r\n\t\t\t//filter for filled-in fields:\r\n\t\t\tlet fields = self.fields.toArray();\r\n\t\t\tfields = fields.filter( field => $( field ).val() != '' );\r\n\r\n\t\t\t//if the length is the same, both fields are filled in:\r\n\t\t\tif( fields.length == fullLength )\r\n\t\t\t\treturn true;\r\n\r\n\t\t\treturn false;\r\n        }\r\n\r\n\r\n        createSession( self ){\r\n\r\n            const appId = $('#field-appid-text').val();\r\n            const secretKey = $('#field-secretkey-text').val();\r\n\r\n            let user = new Talk.User({ id: userSettings.uid, name: 'test' });\r\n            let session = new Talk.Session({\r\n                appId: appId,\r\n                me: user,\r\n                signature: CryptoJS.HmacSHA256(user.id, secretKey).toString(CryptoJS.enc.Hex)\r\n            });\r\n\r\n            return session;\r\n        }\r\n    }\r\n\r\n\r\n    //user Role validation\r\n    class UserRoleValidator {\r\n\r\n        constructor( fields, apiConnection ){\r\n            this.fields = fields;\r\n            this.parent = fields.first().parent().parent();\r\n            this.apiConnection = apiConnection\r\n\r\n            this.setEvents();\r\n        }\r\n\r\n        /**\r\n\t\t * Set all events for this class\r\n\t\t */\r\n\t\tsetEvents(){\r\n\r\n\t\t\tlet self = this;\r\n\r\n\t\t\tfor( let i = 0; i < self.fields.length; i++ ){\r\n\r\n                let field = $( this.fields[ i ] );\r\n\t\t\t\tfield.on( 'change', event => {\r\n\r\n                    field.removeClass( 'config-false' );\r\n                    field.siblings('.config-error').remove();\r\n\r\n\t\t\t\t\tif( field.is(':checked' ) ){\r\n                        self.validateRole( self, field );\r\n                    }\r\n\r\n                    self.validateFields( self );\r\n\t\t\t\t});\r\n            }\r\n\r\n\t\t}\r\n\r\n        /**\r\n         * Validate the role being switched\r\n         *\r\n         * @param Object self\r\n         * @param Object field\r\n         */\r\n        validateRole( self, field ){\r\n\r\n            let session = this.apiConnection.createSession( this.apiConnection );\r\n\r\n            if( typeof( session.hasConfiguration ) == 'undefined' )\r\n                return true;\r\n\r\n\r\n            try{\r\n\r\n                let _value = field.val();\r\n\t\t\t\tsession.hasConfiguration( _value ).then( isValid => {\r\n\r\n                    let _parent = self.fields.parent();\r\n\r\n                    if( !isValid ){\r\n\r\n                        field.addClass( 'config-false' );\r\n                        field.parent().append('<p class=\"config-error\">- '+TalkJS.errors.configurationNotAvailable+'</p>' );\r\n\r\n                    }else{\r\n                        return true;\r\n                    }\r\n\t\t\t\t});\r\n\r\n\t\t\t} catch( e ){\r\n                return true;\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        /**\r\n         * Validate fields\r\n         *\r\n         * @param Object self\r\n         */\r\n        validateFields( self ){\r\n\r\n            let _validated = true;\r\n\r\n            for( let i = 0; i < self.fields.length; i++ ){\r\n\r\n                let field = $( this.fields[ i ] );\r\n                if( field.hasClass( 'config-false' ) )\r\n                    _validated = false;\r\n\r\n            }\r\n\r\n            self.parent.find('.validation-errors').remove();\r\n\r\n            if( _validated == false ){\r\n                self.parent.append('<div class=\"validation-errors\">'+TalkJS.errors.configurationsNotSet+'</div>');\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\t// Settings Page\r\n\tclass SettingsPage {\r\n\r\n\t\tconstructor(){\r\n\r\n            let _fields = $( '.check-connection' );\r\n            if( _fields.length > 0 ) {\r\n\t\t\t\tthis.apiValidator = new ApiValidator( _fields );\r\n\t\t\t\tthis.userRoleValidator = new UserRoleValidator( $('.check-configurations'), this.apiValidator );\r\n                this.setEvents()\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\tsetEvents(){\r\n\r\n\t\t\t$('.button-wrapper .button-primary').on( 'click tap', event => {\r\n                event.preventDefault();\r\n\r\n                if( $('.settings-page-wrapper .validated-false').length > 0 ){\r\n\r\n                    $('.settings-page-wrapper .general-error-msg' ).addClass( 'active' );\r\n                    setTimeout( () => {\r\n                        $('.settings-page-wrapper .general-error-msg').removeClass( 'active' );\r\n                    }, 2000 );\r\n\r\n                }else{\r\n                    $('.settings-page-wrapper form').submit();\r\n                }\r\n\r\n\r\n            });\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tTalk.ready.then( () => {\r\n\t\tnew SettingsPage();\r\n\r\n\t});\r\n\r\n\r\n"]}